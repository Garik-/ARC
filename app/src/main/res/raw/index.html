<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ARC - Android Remote Control</title>
<style>
/*! normalize.css v3.0.2 | MIT License | git.io/normalize */
html {
font-family: sans-serif;
-webkit-text-size-adjust: 100%;
-ms-text-size-adjust: 100%;
}
body {
margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
display: block;
}
audio,
canvas,
progress,
video {
display: inline-block;
vertical-align: baseline;
}
audio:not([controls]) {
display: none;
height: 0;
}
[hidden],
template {
display: none;
}
/* --- */

* {
-webkit-box-sizing: border-box;
-moz-box-sizing: border-box;
box-sizing: border-box;
}
*:before,
*:after {
-webkit-box-sizing: border-box;
-moz-box-sizing: border-box;
box-sizing: border-box;
}
html {
font-size: 10px;

-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}
body {
font-family: "Tahoma", Arial, sans-serif;
font-size: 14px;
line-height: 1.42857143;
color: #555;
background-color: #fff;
}


h1,
h2,
h3,
h4,
h5,
h6,
.h1,
.h2,
.h3,
.h4,
.h5,
.h6 {
font-family: inherit;
font-weight: 500;
line-height: 1.1;
color: inherit;
}

h1,
.h1,
h2,
.h2,
h3,
.h3 {
margin-top: 20px;
margin-bottom: 10px;
}

h4,
.h4,
h5,
.h5,
h6,
.h6 {
margin-top: 10px;
margin-bottom: 10px;
}

h1,
.h1 {
font-size: 36px;
}
h2,
.h2 {
font-size: 30px;
}
h3,
.h3 {
font-size: 24px;
}
h4,
.h4 {
font-size: 18px;
}
h5,
.h5 {
font-size: 14px;
}
h6,
.h6 {
font-size: 12px;
}

p {
margin: 0 0 10px;
}

.container {
padding-right: 15px;
padding-left: 15px;
margin-right: auto;
margin-left: auto;
}
@media (min-width: 768px) {
.container {
width: 750px;
}
}
@media (min-width: 992px) {
.container {
width: 970px;
}
}
@media (min-width: 1200px) {
.container {
width: 1170px;
}
}


header {
position: relative;
padding: 30px 0;
color: #d4e3ef;
text-align: left;
text-shadow: 0 1px 0 rgba(0,0,0,.1);
background-color: #6389a8;
background-image: -webkit-gradient(linear,left top,left bottom,from(#49708f),to(#6389a8));
background-image: -webkit-linear-gradient(top,#49708f 0,#6389a8 100%);
background-image: -o-linear-gradient(top,#49708f 0,#6389a8 100%);
background-image: linear-gradient(to bottom,#49708f 0,#6389a8 100%);
filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#49708f', endColorstr='#6F5499',
GradientType=0);
background-repeat: repeat-x;
font-size: 24px;
font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
}

header h1 {

font-size: 60px;
line-height: 1;
margin-top: 0;
margin-bottom: 0;
color: #fff;
}

header p {
margin-bottom: 0;
font-weight: 300;
line-height: 1.4;
}

h2 {
font-size: 19px;
line-height: 25px;
font-family: 'WOL_SB','Segoe UI Semibold','Segoe UI',Tahoma,Helvetica,sans-serif;
font-weight: 600;
margin-bottom: 10px;
}

.para {
font-size: 13px;
line-height: 20px;
color: #505050;
margin-bottom: 15px;
}

table {
background-color: transparent;
}

th {
text-align: left;
}
.table {
width: 100%;
max-width: 100%;
margin-bottom: 20px;
border-collapse: collapse;
}
.table > thead > tr > th,
.table > tbody > tr > th,
.table > tfoot > tr > th,
.table > thead > tr > td,
.table > tbody > tr > td,
.table > tfoot > tr > td {
padding: 8px;
line-height: 1.42857143;
vertical-align: top;
border-top: 1px solid #ddd;
}
.table > thead > tr > th {
vertical-align: bottom;
border-bottom: 2px solid #ddd;
}

.stream {
background-color: #f5f5f5;

background-image: -webkit-gradient(linear,left top,left bottom,from(#f5f5f5),to(#ffffff));
background-image: -webkit-linear-gradient(top,#f5f5f5 0,#ffffff 100%);
background-image: -o-linear-gradient(top,#f5f5f5 0,#ffffff 100%);
background-image: linear-gradient(to bottom,#f5f5f5 0,#ffffff 100%);
filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#49708f', endColorstr='#ffffff',
GradientType=0);
background-repeat: repeat-x;
padding: 30px 0;
text-align: center;
}
.stream__image {
display: inline-block;
margin:0 auto;
border:1px solid #cacfd2;
}

</style>
</head>
<body>
<header>
    <div class="container">
        <h1>ARC</h1>

        <p>Android Remote Control</p>
    </div>
</header>
<div class="stream">
    <div class="container"><img class="stream__image" src="/stream" alt="Видео"></div>
</div>
<div class="container">
    <h2>Перемещение автомобиля с помощью клавиатуры</h2>

    <p class="para">После включения функции управления на мобильном устройстве можно перемещать
        автомобиль, используя клавиатуру.</p>
    <table class="table">
        <thead>
        <tr>
            <th>Перемещение автомобиля</th>
            <th>Сочетание клавиш</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Вверх и влево</td>
            <td>W + A</td>
        </tr>
        <tr>
            <td>Вверх</td>
            <td>W</td>
        </tr>
        <tr>
            <td>Вверх и вправо</td>
            <td>W + D</td>
        </tr>
        <tr>
            <td>Влево</td>
            <td>A</td>
        </tr>
        <tr>
            <td>Вправо</td>
            <td>D</td>
        </tr>
        <tr>
            <td>Вниз и влево</td>
            <td>S + A</td>
        </tr>
        <tr>
            <td>Вниз</td>
            <td>S</td>
        </tr>
        <tr>
            <td>Вниз и вправо</td>
            <td>S + D</td>
        </tr>
        </tbody>
    </table>
</div>
<script>
        (function() {
            function getXmlHttp()
            {
              var xmlhttp;
              try {
                xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
              } catch (e) {
                try {
                  xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (E) {
                  xmlhttp = false;
                }
              }
              if (!xmlhttp && typeof XMLHttpRequest!='undefined') {
                xmlhttp = new XMLHttpRequest();
              }
              return xmlhttp;
            }


            var keys = {
                'W':"up",
                'A':"left",
                'S':"down",
                'D':"right",
                'W+A':"upleft",
                'W+D':"upright",
                'S+A':"downleft",
                'S+D':"downright"
                },
            req = getXmlHttp(),
            bind = {},
            state = {},
            lastKeyDown = 0;

            (function() { // prepareKeys
                for (var k in keys) {
                    if((k.indexOf('+')+1)) {
                        var arr = k.split('+'), hash = 0;
                        for(var j in arr) {
                            hash += arr[j].charCodeAt(0);
                        }
                        bind[hash]= keys[k];
                    }
                    else {
                        bind[k.charCodeAt(0)] = keys[k];
                    }
                }
            })();

            function sendCommand(command) {
                //console.log("POST /command/"+command);
            	req.open('POST', '/command/'+command, true);
            	req.send();
            }

            function isBindKey(e) {
                if (e.ctrlKey || e.altKey || e.metaKey) return false;

                var find = false;
                for (var k in keys) {
                    if((k.indexOf('+')+1)) continue;

                    if(k.charCodeAt(0) == e.keyCode) {
                        find = true;
                        break;
                    }
                }

                return find;
            }


            function keypress(e) {
            	if(!isBindKey(e)) return;

                var key = e.keyCode;

                switch(e.type) {
                    case "keydown":
                        if(!state[key]) {
                            state[key] = true;
                        
                            sendCommand(bind[key + lastKeyDown]);
                            lastKeyDown = key + lastKeyDown;
                        }
                        break;
                    case "keyup":
                        
                        state[key] = false;
                        lastKeyDown -= key;

                        sendCommand(bind[lastKeyDown ? lastKeyDown : key]);
                        break;
                }
            	
            }

            document.addEventListener("keydown", keypress);
            document.addEventListener("keyup", keypress);
        })();


</script>
</body>
</html>